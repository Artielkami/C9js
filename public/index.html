<!doctype html>
<html lang="en" ng-app="demoApp">
	<head>
		<meta charset="UTF-8">
		<base href="/">
		<title>Demo d3js</title>
		<!-- ICON -->
		<link rel="icon" href="images/icon.ico">
		<!-- CSS -->
		<link rel="stylesheet" href="libs/bootstrap/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/main.css"> <!-- custom styles -->
		<!-- JS -->
		<script src="libs/angular/angular.min.js"></script>
		<script src="libs/angular-route/angular-route.min.js"></script>
		<script src="libs/jquery/dist/jquery.min.js"></script>
		<!-- ANGULAR CUSTOM -->
		<script src="js/app.js"></script>
		<!-- CONTROLLERS -->
		<script src="js/controllers/DemoCtrl.js"></script>
		<script src="js/factory/UploadFactory.js"></script>
		<!-- SERVICES -->
		<script src="js/services/d3.js"></script>
		<!-- DIRECTIVES -->
		<script src="js/directives/d3Bar.js"></script>
		<script src="js/directives/d3DonutChart.js"></script>
		<script src="js/directives/d3SortableBar.js"></script>
		<script src="js/directives/ngFileSelect.js"></script>
		<script src="js/directives/userInteraction.js"></script>
		<!-- <script src="js/appRoutes.js"></script> -->
		<!-- Open-layer Angular Directives -->
		<script src="libs/openlayers3/build/ol.js"></script>
	    <script src="libs/angular-openlayers-directive/dist/angular-openlayers-directive.min.js"></script>
	    <script src="libs/angular-sanitize/angular-sanitize.min.js"></script>

	    <!-- DimpleJS -->
	    <script src="libs/dimple/lib/d3.v3.4.8.js"></script>
  		<!-- <script src="libs/dimple/dist/dimple.v2.1.6.min.js"></script> -->
	    <link rel="stylesheet" href="libs/openlayers3/build/ol.css">
	    <link rel="stylesheet" href="libs/angular-openlayers-directive/dist/angular-openlayers-directive.css" />
		<!-- END ANGULAR CUSTOM -->
		<script type="text/javascript" src="http://erozate.iutbayonne.univ-pau.fr/windapi/?v=2.1&file=WIND"></script>
        <script type="text/javascript" src="http://erozate.iutbayonne.univ-pau.fr/windapi/?v=2.1&file=WIND.Map"></script>
	</head>
	<body ng-controller="DemoCtrl">

		<!-- header -->
		<header>
			<nav class="navbar navbar-default navbar-fixed-top">
				<div class="container">
					<div class="navbar-header">
						<a class="navbar-brand" href="/">
							<img src="images/icon.ico" alt="" width="32px" height="32px">
						</a>
						<a class="navbar-brand" href="/">d3Team</a>
					</div>
					<div class="navbar-header navbar-right">
						<ul class="nav navbar-nav">
							<li class="active"><a href="/">Home</a></li>
							<li><a href="/">About</a></li>
							<li><p class="navbar-text">Version 1.0</p></li>
						</ul>
					</div>
				</div>
			</nav>
		</header>
		<!-- Tab1 : Graph -->
		<section class="col-lg-4 col-lg-offset-8">
			<div class="container-fluid" id="input-data">
				<div class="row">
					<div class="input-group">
						<div class="input-group-btn">
							<div class="btn btn-primary btn-file" id="choose-file">
								<i class="glyphicon glyphicon-folder-open"></i>&nbsp;Browse&hellip;
								<input class="form-control" type="file" ng-file-select="onFileSelect($files)">
							</div>
						</div>
						<input class="form-control" id="input-file" type="text" placeholder="Please select file..." readonly>
					</div>
				</div> <!-- Input-file -->
				<div class="row">
					<div id="graph">
						<!-- <d3-bars data="d3Data" label="name" on-click="d3OnClick(item)"></d3-bars> -->

					</div>
				</div>
			</div>
		</section>
		<!-- Tab2: Map -->
		<section class="col-lg-8">
		</section><!-- Tab2: Map -->
		<script type="text/javascript">
			
				// Process choose file
				$('#choose-file').on('change', ':file', function() {
					var input_file = $('#input-file'),
						input = $(this),
					label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
					input_file.val(label);
				});

				// Init data
				var d3Data = [
							{"name" : "Akai",
							"data" : "10"},

							{"name" : "So",
							"data" : "50"},
							
							{"name" : "Good",
							"data" : "30"}
						];


				// Create graph
				var width = 400;
		        var chart = d3.select("#graph");

		        // Create tooltip
		        var tooltip = d3.select("body")
		                          .append("div")
		                          .attr('class', 'd3-tip')
		                          .style("position", "absolute")
		                          .style("z-index", "10")
		                          .style("visibility", "hidden");

		        // define render function
		        render = function(data){
		          // remove all previous items before render
		          chart.selectAll("*").remove();

		          // setup variables
		          var height, max;
		          // width = d3.select(iElement[0])[0][0].offsetWidth * 9/10;
		          
		            // 20 is for margins and can be changed
		          height = data.length * 35;
		            // 35 = 30(bar height) + 5(margin between bars)
		          // max = 98;
		            // this can also be found dynamically when the data is not static
		          max = Math.max.apply(Math, data.map(function(value, key) {return value.data;} ));
		          // adjust it if over the width

		          // set the height based on the calculations above
		          // chart.attr('height', height);

		          //create the rectangles for the bar chart
		          var hoverDiv = chart.append("div").attr("class", "chart")
		             .selectAll("div")
		             .data(data).enter().append("div").attr('id', function(value, key) { return 'graph-' + key});

		            hoverDiv
		             .style("height", "30px")
		             .transition().ease("elastic")
		             .style("width", function(d) { return d.data*width/max + "px"; })
		             .text(function(d) { return d.name ; });

		            hoverDiv
		              .on("mouseover", function(d){ tooltip.html("<strong>Value:</strong> <span style='color:red'>" + d.data + "</span>").style("visibility", "visible");
		              		if (d.name == 'Akai'){
		              			var react1 = new WIND.ExternalReaction(annot1,"highlight");
								var i1 = new WIND.Interaction(evt1, new Array(react1));
								i1.activate();
		              		}
		              		
		          			})
		              .on("mousemove", function(d){return tooltip.html("<strong>Value:</strong> <span style='color:red'>" + d.data + "</span>").style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
		              .on("mouseout", function(d){return tooltip.html("<strong>Value:</strong> <span style='color:red'>" + d.data + "</span>").style("visibility", "hidden");});
		        };

		        // random color for bar
		        random = function() {
		          return Math.floor(Math.random() * 255);
		        }
		        // Render graph
		        render(d3Data);
		
				var m = new WIND.Map('map', {'type':'OpenStreetMap','zoom':9,'latitude':43.442174,'longitude':-0.973270,'top':50});
				
				var annot1 = m.createAnnotation("Town","Bayonne","MULTIPOLYGON(((-1.49222966988623 43.5088419085818,-1.49223686780896 43.5090127768587,-1.49228470289166 43.5102553349985,-1.49205623076566 43.5117499538144,-1.48863740035385 43.5118825596091,-1.48723190248817 43.5121303073284,-1.48633432652745 43.5129837140103,-1.48605487925749 43.5135069860469,-1.48529867650942 43.5141450782861,-1.48437592189305 43.5143262046024,-1.48415352626799 43.5142413022578,-1.48323910259665 43.5138901976731,-1.48273195231311 43.513634972183,-1.48228365408603 43.5133065319567,-1.48083645556501 43.5134185657804,-1.47960240059622 43.5137529236202,-1.479215483007 43.5137707313476,-1.47868272393386 43.513980280716,-1.47789363387039 43.5138298415761,-1.47647132635142 43.513848158815,-1.47520013874714 43.5141147099246,-1.47468253380769 43.5145092582596,-1.47423960387891 43.5146218037584,-1.47350577113403 43.5147477127372,-1.47261855661512 43.5149738706462,-1.47237374460102 43.5151474504452,-1.47162548175931 43.5154820890254,-1.47155069103526 43.5157414123457,-1.47106705680908 43.5161574223988,-1.4706241070043 43.5162699532169,-1.46995910975936 43.5160686882535,-1.46947466432064 43.5160899010344,-1.4692290578456 43.5166346100115,-1.46856641445621 43.5169579596773,-1.46797809355346 43.5170147851497,-1.46557293026375 43.5164624943644,-1.46544130110443 43.5165279529988,-1.46151307640313 43.518420809156,-1.46058603070574 43.5185606446341,-1.46002590540759 43.519042176262,-1.45853504747379 43.5188832961315,-1.45815935816603 43.5187934235023,-1.45647950675783 43.5183906648944,-1.45490833210383 43.5170635142815,-1.45404682843588 43.5167391706961,-1.45298262650436 43.5167116077801,-1.45259707214503 43.5164725904369,-1.44997768631097 43.5164253793972,-1.44744924433894 43.5162326592972,-1.44376630853769 43.5150536177289,-1.44274391815484 43.5145224716467,-1.44101202721898 43.5144429261614,-1.44041888448934 43.5137194264272,-1.43766932176575 43.5131785853341,-1.43729297660321 43.5133350353684,-1.43248628082256 43.5153193774556,-1.4316743919794 43.5149931281173,-1.42985569337087 43.5136392361764,-1.4281313465646 43.5115016894508,-1.42727850060792 43.5105738065715,-1.42582114593523 43.5094556820437,-1.42562843210466 43.5087872127325,-1.42512607712533 43.5086645373271,-1.42537801704528 43.5080166425068,-1.42480049427695 43.5075048745536,-1.4250548018086 43.5068929772446,-1.42340728978898 43.5044321161886,-1.42220374132292 43.5048657676755,-1.42160696034017 43.5041247847738,-1.42152376528667 43.5040225396333,-1.42047987723701 43.5027270852475,-1.41833796376247 43.5024140741551,-1.41888435919464 43.5010096409963,-1.4187352642588 43.5002705847438,-1.41794365661691 43.5002270133904,-1.41616895819561 43.4986466866468,-1.41580609810937 43.4978862031561,-1.41573710790157 43.4977411974687,-1.41776834066361 43.4969324609124,-1.41992238916052 43.4966791372884,-1.423479699656 43.4961036985527,-1.42583676243817 43.4954504384181,-1.4264579152359 43.4951854984169,-1.42754322065117 43.4947229350242,-1.43177026078373 43.491443726204,-1.43444651559263 43.4899884836352,-1.43824649905832 43.4886577464214,-1.43979491575403 43.4881149340165,-1.44296396783635 43.4866453072913,-1.44428408439375 43.4860341480942,-1.44424266825709 43.4854078329614,-1.44417602350365 43.4843999701567,-1.44323166520757 43.4833063931795,-1.44310902758332 43.4820293909613,-1.44506919489999 43.4818936681613,-1.44527148800076 43.4814206463858,-1.44594871778635 43.4812793813809,-1.44584459186236 43.4809036943076,-1.44564585456622 43.4801890958837,-1.44516340763042 43.4797864754915,-1.44535227670869 43.4790892079419,-1.44541834060021 43.4788467119055,-1.44575500990781 43.478757592729,-1.44584442869556 43.4776483960735,-1.44770658736165 43.4764831853827,-1.44937177779926 43.4758289235618,-1.45401589079194 43.4748452367101,-1.45398217762342 43.4760236112953,-1.45524873047756 43.4773851125972,-1.45635875358388 43.4786479959169,-1.45758712920168 43.4780883418125,-1.45821320534837 43.4789476612989,-1.45854285844725 43.4792009806047,-1.45933362306957 43.4798112254458,-1.45977972681721 43.480155277839,-1.46007957718023 43.4803859334801,-1.46271920143576 43.4780777286194,-1.46600043788561 43.4763746018341,-1.46697142146247 43.476756808247,-1.46779739142089 43.4760442340972,-1.46596694431328 43.4748491361927,-1.46632633925172 43.4744426877045,-1.46626516631976 43.4737356406829,-1.46687042791028 43.4727484135043,-1.46694101135811 43.4724263695301,-1.46629986009634 43.4718521407157,-1.46552510637997 43.4714609516683,-1.46589667510867 43.47119529783,-1.46735249982321 43.4714841155785,-1.46939626695169 43.4711429471702,-1.46942352512105 43.470701824869,-1.46947979443865 43.4698246728856,-1.47002007508024 43.4680965017132,-1.46922884188562 43.4669255948854,-1.47401977842584 43.4669924232573,-1.47765559122281 43.4673947273917,-1.47820141951795 43.4663054220969,-1.48008655190883 43.466432496343,-1.48169020353014 43.4644418883059,-1.48101443891858 43.4634772624077,-1.48052001094176 43.4628968940487,-1.48041915316432 43.4622974354688,-1.48076022598291 43.4611102243531,-1.48154289716482 43.4599032494534,-1.48260546753793 43.4590739401978,-1.48414022528351 43.4585773322947,-1.48534675378965 43.4582727332251,-1.48589973166149 43.4578232739987,-1.48551090640857 43.4572350630302,-1.48540331658071 43.4571708438076,-1.48465301413348 43.4565305051142,-1.48287211004836 43.4553319044538,-1.48231991146023 43.4546484539591,-1.48349193821883 43.4539554483657,-1.48539855623743 43.4548970288334,-1.4859980033224 43.4555458033706,-1.48658557529455 43.4549157514275,-1.48707648633709 43.4548931841861,-1.48788684812853 43.4551406941813,-1.4884457258473 43.4547590459565,-1.48900451346553 43.4549474406939,-1.48926487389671 43.4545454577996,-1.4900359514681 43.4543325389953,-1.49028773549189 43.4538236527777,-1.49189270504977 43.453004882505,-1.49264545221758 43.4520112343233,-1.49277640901934 43.4506912574154,-1.49331463060145 43.449494939828,-1.49547919762409 43.4505694260104,-1.49510767147227 43.4514021362316,-1.49474586292946 43.4534787008473,-1.49442595834078 43.4549136365708,-1.49396046355005 43.4569217301309,-1.49465136785356 43.4569270697414,-1.49528381310081 43.458531231616,-1.49553034879279 43.4596553461395,-1.49563551256207 43.4609081866358,-1.49552135622148 43.4618234972257,-1.49568787208628 43.4625979156828,-1.4953038505606 43.4638578399827,-1.49723218737823 43.4639119498551,-1.49715172085493 43.464083867826,-1.49685825663225 43.4647097101519,-1.4970208338038 43.4660161792819,-1.49660375585812 43.4665082852707,-1.49639383672139 43.4667549021241,-1.49590884276622 43.4674164149846,-1.49496733157094 43.4684889601235,-1.49436503996009 43.468942282499,-1.49386157899766 43.4693920901458,-1.49321126064046 43.4698471120262,-1.49294710496034 43.4702141943681,-1.49272602037903 43.4710766086347,-1.49227804377717 43.4715945347263,-1.49098468049105 43.4720435128894,-1.49029345542112 43.4726071752232,-1.49064361941783 43.4737997928318,-1.49068058630525 43.4742252467819,-1.49080196873442 43.474706462166,-1.49083092861119 43.4748219187449,-1.49162412500627 43.4759926244534,-1.49260975766393 43.4771193828023,-1.49513741037379 43.4755482738079,-1.49736972510654 43.4751266836425,-1.49678460254917 43.4768927020697,-1.49886608867095 43.4771763867047,-1.50422326023886 43.4779031543874,-1.50435754334193 43.4783849316176,-1.50452054197665 43.4789780486047,-1.50458354871144 43.4791994984737,-1.50467603611857 43.481398099883,-1.50440764037288 43.4816385707476,-1.50205898138744 43.4833457901737,-1.5015249607451 43.4837420891038,-1.49960503307716 43.4842454218676,-1.498850317207 43.4858896705583,-1.49819121371815 43.4873769179819,-1.49653286177264 43.4910026209982,-1.49522325831659 43.4934335214493,-1.49492720922942 43.4939811140274,-1.49488193836019 43.4940662214591,-1.49423845782362 43.4963600531134,-1.49407931645952 43.4982748529806,-1.49292337625412 43.5000652638678,-1.49195191815818 43.5009955634457,-1.49137175731231 43.5015521992789,-1.48998063755163 43.5025396365814,-1.49008103324487 43.5028123455747,-1.49013150685753 43.5029528137272,-1.49208053385658 43.508222496784,-1.49216850590992 43.5085843011009,-1.49222966988623 43.5088419085818)))",{"style":"strokeColor:blue,strokeWidth:3,strokeOpacity:1,fillColor:blue,fillOpacity:0.3"});
				console.log(m);
				var evt1 = new WIND.SelectEvent("click",annot1);
				//Creating the reactions and the interactions
			evt1.trigger(function(e){
				var react1 = new WIND.ExternalReaction(annot1,"highlight");
				var i1 = new WIND.Interaction(evt1, new Array(react1));
				i1.activate();
				var idx= $('#graph-0');
				console.log(idx);
				// tooltip.html("<strong>Value:</strong> <span style='color:red;left:" + idx[0].offsetLeft + ";top:" + idx[0].offsetTop + ";'>" + idx.html() + "</span>").style("visibility", "visible");
				idx[0].style.backgroundColor = 'red';
			});


		</script>
	</body>
		
</html>
