function pointInPolygon(e,t){var n=t.length-1;var r=false;for(var i=0;i<t.length;i++){if(t[i].y<e.y&&t[n].y>=e.y||t[n].y<e.y&&t[i].y>=e.y){if(Number(t[i].x)+Number((e.y-t[i].y)/(t[n].y-t[i].y)*(t[n].x-t[i].x))<Number(e.x)){r=!r}}n=i}return r}function clicCoordinates(e,t,n){var r=new Point(e.layerX,e.layerY);var i=r.x/n.canvas.offsetWidth;var s=r.y/n.canvas.offsetHeight;var o=i*t[0];var u=s*t[1];var a=o+parseFloat(n.origin.x);var f=u+parseFloat(n.origin.y);var l=new Point(a,f);return l}WIND.Photo=function(e,t){this.draggable=false;this.resizable=false;this.top=10;this.left=10;this.width=600;this.height=400;this.color="#3366CC";this.border="#3366CC 2px solid";this.name="Photo Displayer";this.icon=lib_path+"images/pvizicon.png";this.header=false;this.removable=false;this.configurable=false;if(t.draggable==true)this.draggable=t.draggable;if(t.resizable==true)this.resizable=t.resizable;if(t.header==true)this.header=t.header;if(t.removable==true)this.removable=t.removable;if(t.configurable==true)this.configurable=t.configurable;if(this.draggable==true||this.removable==true||this.configurable==true)this.header=true;var n=document.createElement("div");n.id=e+"Outer";n.style.position="absolute";if(t.top)this.top=t.top;n.style.top=this.top+"px";if(t.left)this.left=t.left;n.style.left=this.left+"px";if(t.width)this.width=t.width;n.style.width=this.width+"px";if(t.height)this.height=t.height;n.style.height=this.height+"px";if(t.color)this.color=t.color;if(t.border)this.border=t.border;n.style.border=this.border;if(t.parentEl)this.parentEl=t.parentEl;if(t.name)this.name=t.name;if(t.icon)this.icon=t.icon;var r;if(document.getElementById(e))r=document.getElementById(e);else{r=document.createElement("div");r.id=e}r.style.position="absolute";r.style.top="0px";r.style.width="100%";r.style.height="100%";n.appendChild(r);if(t.parentEl){this.parentEl=t.parentEl;document.getElementById(t.parentEl).appendChild(n)}else document.body.appendChild(n);if(this.header){var i=document.createElement("div");i.id=e+"Handle";i.style.position="absolute";i.style.width="100%";i.style.height="20px";i.style.backgroundColor=this.color;if(this.draggable)i.style.cursor="move";i.style.zIndex=2;var s=document.createElement("img");s.src=this.icon;s.alt="[ ]";s.title="PhotoDisplayer";s.style.cssFloat="left";i.appendChild(s);var o=document.createElement("span");o.style.color="#FFFFFF";o.style.paddingLeft="3px";o.appendChild(document.createTextNode(this.name));i.appendChild(o);var u=document.createElement("div");u.id=e+"Configuration";u.style.position="absolute";u.style.width="100%";u.style.marginTop="20px";u.style.backgroundColor="#E4E4E4";u.style.zIndex=2;u.style.display="none";n.appendChild(u);var a=document.createElement("span");a.appendChild(document.createTextNode("Name of displayer: "));u.appendChild(a);u.appendChild(document.createElement("br"));var f=document.createElement("input");f.type="text";f.id=e+"Configuration_Name";f.name=e+"Configuration_Name";f.size="30";u.appendChild(f);u.appendChild(document.createElement("br"));var l=document.createElement("input");l.type="button";l.id=e+"Configuration_OK";l.name=e+"Configuration_OK";l.value="OK";u.appendChild(l);this.eventConfigured=new YAHOO.util.CustomEvent("eventConfigured");var c=this;l.onclick=function(){var t=document.getElementById(e+"Configuration_Name").value;if(t!=null&&t!=""){c.name=t;o.removeChild(o.firstChild);o.appendChild(document.createTextNode(c.name))}u.style.display="none";c.eventConfigured.fire(c)};this.eventConfigured.subscribe(this.onConfigure,this,true);var h=document.createElement("input");h.type="button";h.id=e+"Configuration_Cancel";h.name=e+"Configuration_Cancel";h.value="Cancel";u.appendChild(h);h.onclick=function(){u.style.display="none"};if(this.removable){this.eventRemoved=new YAHOO.util.CustomEvent("eventRemoved");var p=document.createElement("img");p.src=lib_path+"images/close.png";p.alt="X";p.title="Delete";p.style.backgroundColor="#EFEFEF";p.style.cssFloat="right";p.style.cursor="pointer";i.appendChild(p);p.onclick=function(){if(confirm("Do you really want to delete it?")){c.destroy();c.eventRemoved.fire(c)}};this.eventRemoved.subscribe(this.onRemove,this,true)}if(this.configurable){var d=document.createElement("img");d.src=lib_path+"images/gear.png";d.alt="*";d.title="Preferences";d.style.cssFloat="right";d.style.marginRight="10px";d.style.cursor="pointer";i.appendChild(d);d.onclick=function(){u.style.display="block"}}n.appendChild(i);if(this.draggable){var v=new YAHOO.util.DD(e+"Outer");v.setHandleElId(e+"Handle");this.eventDragged=new YAHOO.util.CustomEvent("eventDragged");v.on("endDragEvent",function(e){this.eventDragged.fire(this)},this,true);this.eventDragged.subscribe(this.onDrag,this,true);if(t.parentEl){var m=document.getElementById(t.parentEl);var g=n.offsetLeft-m.offsetLeft;var y=m.offsetLeft+m.offsetWidth-n.offsetLeft-n.offsetWidth;var b=n.offsetTop-m.offsetTop;var w=m.offsetTop+m.offsetHeight-n.offsetTop-n.offsetHeight;v.setXConstraint(g,y);v.setYConstraint(b)}else{var g=n.offsetLeft;var b=n.offsetTop;v.setXConstraint(g);v.setYConstraint(b)}}}if(this.resizable){var E=document.createElement("div");E.id="yui-gen0";E.className="yui-resize-handle yui-resize-handle-r";var S=document.createElement("div");S.className="yui-resize-handle-inner-r";E.appendChild(S);n.appendChild(E);var E=document.createElement("div");E.id="yui-gen1";E.className="yui-resize-handle yui-resize-handle-b";var S=document.createElement("div");S.className="yui-resize-handle-inner-b";E.appendChild(S);n.appendChild(E);var E=document.createElement("div");E.id="yui-gen2";E.className="yui-resize-handle yui-resize-handle-br";var S=document.createElement("div");S.className="yui-resize-handle-inner-br";E.appendChild(S);n.appendChild(E);var x=new YAHOO.util.Resize(e+"Outer",{minWidth:160,minHeight:160,maxWidth:1200,maxHeight:800});this.eventResized=new YAHOO.util.CustomEvent("eventResized");x.on("endResize",function(e){this.eventResized.fire(this)},this,true);this.eventResized.subscribe(this.onResize,this,true)}this.container=e;this.parentDocument=null;this.parts=[];this.annotations=[];this.interactionList=[];this.photoviewer=new Seadragon.Viewer(e);this.collection=[];this.switchBar=false;this.switchBarContainer;this.open=false;this.tree=false;this.treeContainer;this.parts=[];this.tags;Seadragon.Config.maxZoomPixelRatio=5};WIND.Photo.prototype.destroy=function(){var e=document.getElementById(this.container+"Outer");if(this.parentEl){var t=[];for(var n=0;n<this.parentDocument.viewers.length;n++){if(this.parentDocument.viewers[n].container!=this.container){t.push(this.parentDocument.viewers[n])}}this.parentDocument.viewers=t;document.getElementById(this.parentEl).removeChild(e)}else document.body.removeChild(e)};WIND.Photo.prototype.onDrag=function(){this.top=document.getElementById(this.container+"Outer").offsetTop;this.left=document.getElementById(this.container+"Outer").offsetLeft};WIND.Photo.prototype.onResize=function(){this.width=document.getElementById(this.container+"Outer").offsetWidth;this.height=document.getElementById(this.container+"Outer").offsetHeight};WIND.Photo.prototype.onConfigure=function(){};WIND.Photo.prototype.onRemove=function(){};WIND.Photo.prototype.getValue=function(){return{id:this.container,ref:this.ref,rdftype:"http://erozate.iutbayonne.univ-pau.fr/wind#PhotoComponent",name:this.name,innerText:this.innerText,position:{top:this.top,left:this.left},size:{width:this.width,height:this.height},style:{color:this.color,border:this.border,icon:this.icon},annotation:this.annotation,display:this.display,load:this.load,parameter:{draggable:this.draggable?"yes":"no",resizable:this.resizable?"yes":"no",removable:this.removable?"yes":"no",configurable:this.configurable?"yes":"no",header:this.header?"yes":"no",toolbar:"no"}}};WIND.Photo.prototype.onload=function(e){this.photoviewer.addEventListener("open",e)};WIND.Photo.prototype.addCollection=function(e){var t={};t.name=e;t.photos=[];t.miniatures=[];t.tags=[];this.collection.push(t)};WIND.Photo.prototype.getCollection=function(e){for(var t=0;t<this.collection.length;t++){if(this.collection[t].name==e){return this.collection[t]}}return false};WIND.Photo.prototype.addPhoto=function(e,t,n){var r=this.getCollection(n);r.photos.push(e);r.miniatures.push(t);if(this.open==false){this.photoviewer.openDzi(this.collection[0].photos[0]);this.open=true;this.photoviewer.source=new Seadragon.TileSource(600,400,256,10)}};WIND.Photo.prototype.addControlButtons=function(){this.photoviewer.setDashboardEnabled(true)};WIND.Photo.prototype.removeControlButtons=function(){this.photoviewer.setDashboardEnabled(false)};WIND.Photo.prototype.enableZoom=function(){Seadragon.Config.zoomPerClick=2;Seadragon.Config.zoomPerScroll=1.2;Seadragon.Config.zoomPerSecond=2};WIND.Photo.prototype.disableZoom=function(){Seadragon.Config.zoomPerClick=1;Seadragon.Config.zoomPerScroll=1;Seadragon.Config.zoomPerSecond=1};WIND.Photo.prototype.enableMouseNav=function(){this.photoviewer.setMouseNavEnabled(true)};WIND.Photo.prototype.disableMouseNav=function(){this.photoviewer.setMouseNavEnabled(false)};WIND.Photo.prototype.switchTo=function(e){if(e){this.photoviewer.openDzi(e)}else{this.photoviewer.close()}};WIND.Photo.prototype.moveTo=function(e,t){this.photoviewer.viewport.panTo(new Seadragon.Point(e,t),true)};WIND.Photo.prototype.moveBy=function(e,t){this.photoviewer.viewport.panBy(new Seadragon.Point(e,t),true)};WIND.Photo.prototype.zoomTo=function(e){this.photoviewer.viewport.zoomTo(e)};WIND.Photo.prototype.zoomBy=function(e){this.photoviewer.viewport.zoomBy(e)};WIND.Photo.prototype.setSwitchBarContainer=function(e){this.switchBarContainer=e};WIND.Photo.prototype.setTreeContainer=function(e){this.treeContainer=e};WIND.Photo.prototype.addSwitchBar=function(e){if(!this.switchBar){var t=document.createElement("div");t.setAttribute("id",this.switchBarContainer);var n=this.getCollection(e);var r=this.photoviewer;for(var i=0;i<n.photos.length;i++){var s=document.createElement("img");s.setAttribute("src",n.miniatures[i]);s.setAttribute("alt",n.photos[i]);s.setAttribute("border","5");s.setAttribute("bordercolor","white");s.setAttribute("width","110");s.setAttribute("height","70");s.setAttribute("hspace","10");s.onclick=function(){r.openDzi(this.alt)};t.appendChild(s)}document.body.appendChild(t);this.switchBar=true}};WIND.Photo.prototype.removeSwitchBar=function(e){if(this.switchBar){document.body.removeChild(document.getElementById(this.switchBarContainer));this.switchBar=false}};WIND.Photo.prototype.addTree=function(){if(!this.tree){var e=this;var t=document.createElement("div");t.setAttribute("id",this.treeContainer);var n=this.collection;var r;r=new YAHOO.widget.TreeView(t);var i=r.getRoot();for(var s=0;s<n.length;s++){var o=this.collection[s].name;var u=new YAHOO.widget.TextNode(o,i,true)}r.subscribe("labelClick",function(t){e.removeSwitchBar();e.addSwitchBar(t.label)});r.render();var a=document.getElementById("container");document.body.insertBefore(t,a);this.tree=true}};WIND.Photo.prototype.removeTree=function(){if(this.tree){document.body.removeChild(document.getElementById(this.treeContainer));this.tree=false}};WIND.Photo.prototype.createSensiblePart=function(e){var t=new WIND.PhotoPart(e,this);t.initCanvas();this.parts.push(t);return t};Point=function(e,t){this.x=e;this.y=t};WIND.PhotoPart=function(e,t){this.points=[];var n=this;var r=e.lastIndexOf("(");var i=e.lastIndexOf(")");var s=e.substring(r+1,i);this.figure=e.substring(0,r);if(this.figure=="POLYGON"){var o=s.split(",");for(var u=0;u<o.length;u++){var a=o[u].split(" ");var f=new Point(a[0],a[1]);n.points.push(f)}}else if(this.figure=="PIN"){var a=s.split(" ");var f=new Point(a[0],a[1]);n.points.push(f)}this.viewer=t;this.origin=null;this.rect=null;this.canvasValues;this.canvasRest;this.interieur="black";this.contour="black";this.clicdiscov=false};var comparer=function(e,t){var n=e.length;var r=t.length;if(n!=r){return false}else{var i=true;for(var s=0;s<n;s++){if(e[s].x!=t[s].x||e[s].y!=t[s].y){i=false;break}}return i}};WIND.PhotoPart.prototype=new WIND.SensiblePart("photo");WIND.PhotoPart.prototype.initCanvas=function(){if(this.figure=="POLYGON"){this.canvas=document.createElement("canvas");this.canvasValues=this.getCanvasValues();this.canvas.setAttribute("width",this.canvasValues[2]);this.canvas.setAttribute("height",this.canvasValues[3]);var e=this.points;var t=this;this.canvas.onclick=function(n){var r=clicCoordinates(n,t.canvasValues,t);for(var i=0;i<t.viewer.interactionList.length;i++){var s=t.viewer.interactionList[i];var o=s.source;var u=s.event;var a=s.reactions;var r=clicCoordinates(n,t.canvasValues,t);if(u=="click"&&pointInPolygon(r,e)&&comparer(o.points,e)){for(var f=0;f<a.length;f++){a[f].target.callFunction(a[f].calledFunction,a[f].parameters)}}}};this.canvas.onmouseover=function(n){var r=clicCoordinates(n,t.canvasValues,t);if(pointInPolygon(r,e)){Seadragon.Config.zoomPerClick=1;this.style.cursor="pointer"}else{if(!t.clicdiscov){Seadragon.Config.zoomPerClick=2}this.style.cursor="default"}for(var i=0;i<t.viewer.interactionList.length;i++){var s=t.viewer.interactionList[i];var o=s.source;var u=s.event;var a=s.reactions;var r=clicCoordinates(n,t.canvasValues,t);if(u=="mouseover"&&pointInPolygon(r,e)&&comparer(o.points,e)){for(var f=0;f<a.length;f++){a[f].target.callFunction(a[f].calledFunction,a[f].parameters)}}if(u=="mouseout"&&pointInPolygon(r,e)==false&&comparer(o.points,e)){for(var f=0;f<a.length;f++){a[f].target.callFunction(a[f].calledFunction,a[f].parameters)}}}};this.canvas.onmouseout=function(){if(!t.clicdiscov){Seadragon.Config.zoomPerClick=2}for(var n=0;n<t.viewer.interactionList.length;n++){var r=t.viewer.interactionList[n];var i=r.source;var s=r.event;var o=r.reactions;if(s=="mouseout"&&comparer(i.points,e)){for(var u=0;u<o.length;u++){o[u].target.callFunction(o[u].calledFunction,o[u].parameters)}}}};var n=this.canvas.getContext("2d");n.beginPath();var r=this.relativeToAbsolute(this.points[0].x-this.origin.x,this.points[0].y-this.origin.y);n.moveTo(r.x,r.y);for(var i=1;i<this.points.length;i++){var s=this.relativeToAbsolute(this.points[i].x-this.origin.x,this.points[i].y-this.origin.y);n.lineTo(s.x,s.y)}n.closePath();n.fill();this.rect=new Seadragon.Rect(parseFloat(this.origin.x),parseFloat(this.origin.y),this.canvasValues[0],this.canvasValues[1]);this.viewer.photoviewer.drawer.addOverlay(this.canvas,this.rect)}else if(this.figure=="PIN"){var o=document.createElement("img");var u=new Seadragon.Point(parseFloat(this.points[0].x),parseFloat(this.points[0].y));var a=Seadragon.OverlayPlacement.BOTTOM;o.src=lib_path+"images/pin.png";o.onmouseover=function(){this.style.cursor="pointer"};this.viewer.photoviewer.drawer.addOverlay(o,u,a)}};WIND.PhotoPart.prototype.getCanvasValues=function(){var e=1;var t=0;var n=1;var r=0;for(var i=0;i<this.points.length;i++){if(this.points[i].x<e){e=this.points[i].x}if(this.points[i].x>t){t=this.points[i].x}if(this.points[i].y<n){n=this.points[i].y}if(this.points[i].y>r){r=this.points[i].y}}this.origin=new Point(e,n);var s=t-e;var o=r-n;var u=this.relativeToAbsolute(s,o);var a=[s,o,u.x,u.y];return a};WIND.PhotoPart.prototype.relativeToAbsolute=function(e,t){var n=1/this.viewer.photoviewer.source.aspectRatio;var r=this.viewer.photoviewer.source.dimensions.x;var i=this.viewer.photoviewer.source.dimensions.y;return new Point(e*r,t*i/n)};WIND.PhotoPart.prototype.show=function(){this.canvas.style.opacity=1};WIND.PhotoPart.prototype.move=function(e,t){this.viewer.photoviewer.drawer.removeOverlay(this.canvas);var n=this;var r=new Point(e,t);for(var i=0;i<this.points.length;i++){this.points[i].x=parseFloat(this.points[i].x)+parseFloat(e)-parseFloat(this.origin.x);this.points[i].y=parseFloat(this.points[i].y)+parseFloat(t)-parseFloat(this.origin.y)}this.canvasValues=this.getCanvasValues();this.origin=new Point(e,t);this.rect.x=parseFloat(e);this.rect.y=parseFloat(t);this.viewer.photoviewer.drawer.addOverlay(this.canvas,this.rect);if(this.canvasRest!=null){var s=this.canvasRest.getContext("2d");s.clearRect(0,0,this.canvasRest.width,this.canvasRest.height);s.fillRect(0,0,this.viewer.photoviewer.source.dimensions.x,this.viewer.photoviewer.source.dimensions.y);s.globalCompositeOperation="xor";s.beginPath();var o=this.relativeToAbsolute(this.points[0].x,this.points[0].y);s.moveTo(o.x,o.y);for(var i=1;i<this.points.length;i++){var u=this.relativeToAbsolute(this.points[i].x,this.points[i].y);s.lineTo(u.x,u.y)}s.fill();var a=new Seadragon.Rect(0,0,1,1/this.viewer.photoviewer.source.aspectRatio)}};WIND.PhotoPart.prototype.focus=function(){this.viewer.photoviewer.viewport.fitBounds(this.rect)};WIND.PhotoPart.prototype.hide=function(){this.canvas.style.opacity=0};WIND.PhotoPart.prototype.color=function(e,t){var n=this;var r=this.canvas.getContext("2d");r.clearRect(0,0,this.canvas.width,this.canvas.height);r.beginPath();var i=this.relativeToAbsolute(this.points[0].x-this.origin.x,this.points[0].y-this.origin.y);r.moveTo(i.x,i.y);for(var s=1;s<this.points.length;s++){var o=this.relativeToAbsolute(this.points[s].x-this.origin.x,this.points[s].y-this.origin.y);r.lineTo(o.x,o.y)}if(e=="same"){r.fillStyle=this.interieur;r.fill()}else if(e!=null){r.fillStyle=e;r.fill()}if(t=="same"){r.strokeStyle=this.contour;r.lineWidth=30;r.closePath();r.stroke()}else if(t!=null){r.strokeStyle=t;r.lineWidth=30;r.closePath();r.stroke()}this.viewer.photoviewer.drawer.addOverlay(this.canvas,this.rect)};WIND.PhotoPart.prototype.hideRestPhoto=function(e){function u(e,t,n){var r=new Point(e.layerX,e.layerY);var i=r.x/n.canvasRest.offsetWidth;var s=r.y/n.canvasRest.offsetHeight;var o=new Point(i,s*(1/n.viewer.photoviewer.source.aspectRatio));return o}if(!this.canvasRest){this.canvasRest=document.createElement("canvas");this.canvasRest.setAttribute("width",this.viewer.photoviewer.source.dimensions.x);this.canvasRest.setAttribute("height",this.viewer.photoviewer.source.dimensions.y);var t=this.points;var n=this;if(e==true){Seadragon.Config.zoomPerClick=1;this.canvasRest.onclick=function(e){var t=u(e,n.canvasValues,n);n.move(t.x,t.y);n.clicdiscov=true}}restcntx=this.canvasRest.getContext("2d");restcntx.fillRect(0,0,this.viewer.photoviewer.source.dimensions.x,this.viewer.photoviewer.source.dimensions.y);restcntx.globalCompositeOperation="xor";restcntx.beginPath();var r=this.relativeToAbsolute(this.points[0].x,this.points[0].y);restcntx.moveTo(r.x,r.y);for(var i=1;i<this.points.length;i++){var s=this.relativeToAbsolute(this.points[i].x,this.points[i].y);restcntx.lineTo(s.x,s.y)}restcntx.fill();var o=new Seadragon.Rect(0,0,1,1/this.viewer.photoviewer.source.aspectRatio);this.viewer.photoviewer.drawer.addOverlay(this.canvasRest,o)}};WIND.PhotoPart.prototype.showRestPhoto=function(){var e=new Seadragon.Rect(0,0,1,1/this.viewer.photoviewer.source.aspectRatio);this.viewer.photoviewer.drawer.removeOverlay(this.canvasRest,e);this.canvasRest=null;this.clicdiscov=false}