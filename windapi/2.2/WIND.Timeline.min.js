WIND.Timeline=function(e,t){this.type="timeline";this.top=10;this.left=10;this.width=600;this.height=400;this.color="#3366CC";this.border="#3366CC 2px solid";this.name="Timeline Displayer";this.icon=lib_path+"images/tivizicon.png";this.draggable=false;this.resizable=false;this.header=false;this.removable=false;this.configurable=false;wind_timeline=true;if(t.type)this.base=t.type;else this.base="Simile";if(t.draggable==true)this.draggable=t.draggable;if(t.resizable==true)this.resizable=t.resizable;if(t.header==true)this.header=t.header;if(t.removable==true)this.removable=t.removable;if(t.configurable==true)this.configurable=t.configurable;if(this.draggable==true||this.removable==true||this.configurable==true)this.header=true;var n=document.createElement("div");n.id=e+"Outer";n.style.position="absolute";if(t.top)this.top=t.top;n.style.top=this.top+"px";if(t.left)this.left=t.left;n.style.left=this.left+"px";if(t.width)this.width=t.width;n.style.width=this.width+"px";if(t.height)this.height=t.height;n.style.height=this.height+"px";if(t.color)this.color=t.color;if(t.border)this.border=t.border;n.style.border=this.border;if(t.parentEl)this.parentEl=t.parentEl;if(t.name)this.name=t.name;if(t.icon)this.icon=t.icon;var r;if(document.getElementById(e))r=document.getElementById(e);else{r=document.createElement("div");r.id=e}r.style.position="absolute";if(this.header){r.style.top="20px";r.style.height=Number(this.height)-22+"px"}else{r.style.top="0px";r.style.height="100%"}r.style.width="100%";n.appendChild(r);if(t.parentEl){this.parentEl=t.parentEl;document.getElementById(t.parentEl).appendChild(n)}else document.body.appendChild(n);if(this.header){var i=document.createElement("div");i.id=e+"Handle";i.style.position="absolute";i.style.width="100%";i.style.height="20px";i.style.backgroundColor=this.color;if(this.draggable)i.style.cursor="move";i.style.zIndex=2;var s=document.createElement("img");s.src=this.icon;s.alt="[ ]";s.title="TimelineDisplayer";s.style.cssFloat="left";i.appendChild(s);var o=document.createElement("span");o.style.color="#FFFFFF";o.style.paddingLeft="3px";o.appendChild(document.createTextNode(this.name));i.appendChild(o);var u=document.createElement("div");u.id=e+"Configuration";u.style.position="absolute";u.style.width="100%";u.style.marginTop="20px";u.style.backgroundColor="#E4E4E4";u.style.zIndex=10;u.style.display="none";n.appendChild(u);var a=this;var f=document.createElement("span");f.appendChild(document.createTextNode("Name: "));u.appendChild(f);var l=document.createElement("input");l.type="text";l.id=e+"Configuration_Name";l.name=e+"Configuration_Name";l.size="30";l.value=this.name;u.appendChild(l);l.onblur=function(){var t=document.getElementById(e+"Configuration_Name").value;if(t!=null&&t!=""){a.name=t;o.removeChild(o.firstChild);o.appendChild(document.createTextNode(a.name))}a.eventConfigured.fire(a)};u.appendChild(document.createElement("br"));var c=document.createElement("span");c.appendChild(document.createTextNode("Color: "));u.appendChild(c);var h=document.createElement("select");h.id=e+"Configuration_Color";h.name=e+"Configuration_Color";u.appendChild(h);h.style.background=this.color;var p=["#00248E","#0033CC","#809FFE","#BFCFFE","#12127D","#1919B3","#9191FE","#C8C8FE","#24006B","#330099","#AA80FE","#D4BFFE","#2D006B","#400099","#B580FE","#DABFFE","#47006B","#660099","#D580FE","#EABFFE","#6B006B","#990099","#FF80FE","#FFBFFE","#8E006B","#CC0099","#FE80DF","#FEBFEF","#A10048","#E60066","#FE80B9","#FEBFDC","#B20000","#FF0000","#FE8080","#FEBFBF","#B22400","#FF3300","#FE9980","#FECCBF","#B24700","#FF6600","#FEB380","#FED9BF","#B25900","#FF8000","#FEBF80","#FEDFBF","#B26B00","#FF9900","#FECC80","#FEE6BF","#B27D00","#FFB200","#FED980","#FEECBF","#B28F00","#FFCC00","#FEE680","#FEF2BF","#B2A100","#FFE500","#FEF280","#FEF9BF","#B2B300","#FFFF00","#FEFF80","#FEFFBF","#8FB200","#CCFF00","#E6FE80","#F2FEBF","#6BB200","#99FF00","#CCFE80","#E6FEBF","#24B200","#33FF00","#99FE80","#CCFEBF","#008E00","#00CC00","#80FE80","#BFFEBF","#007D47","#00B366","#80FEC8","#BFFEE3","#006B6B","#009999","#80FFFE","#BFFFFE","#00477D","#0066B3","#80C8FE","#BFE3FE"];for(var d=0;d<p.length;d++){var v=new Option(p[d],p[d]);v.style.background=p[d];v.style.position="absolute";v.style.width="100px";v.style.height="30px";if(p[d]==this.color)v.selected=true;h.add(v)}h.onchange=function(){h.style.background=this.options[this.selectedIndex].value;a.color=this.options[this.selectedIndex].value;a.border=this.options[this.selectedIndex].value+" 2px solid";document.getElementById(e+"Handle").style.backgroundColor=a.color;document.getElementById(e+"Outer").style.border=a.border};u.appendChild(document.createElement("br"));this.eventConfigured=new YAHOO.util.CustomEvent("eventConfigured");this.eventConfigured.subscribe(this.onConfigure,this,true);if(a.base=="Simile"){var m=document.createElement("span");m.appendChild(document.createTextNode("Level: "));u.appendChild(m);for(var d=2;d<8;d++){var g=document.createElement("input");g.type="radio";g.id=e+"Configuration_Level"+d;g.name=e+"Configuration_Level";u.appendChild(g);var y=document.createElement("label");y.appendChild(document.createTextNode(WIND.Timeline.Interval[d]+" "));u.appendChild(y);a=this;g.onclick=function(e){a.tl.getBand(0).zoom(true,1485);a.tl.getBand(1).zoom(true,1485);a.tl.layout()}}}u.appendChild(document.createElement("br"));u.appendChild(document.createElement("br"));var b=document.createElement("input");b.type="button";b.id=e+"Configuration_Cancel";b.name=e+"Configuration_Cancel";b.value="Close";u.appendChild(b);b.onclick=function(){u.style.display="none"};if(this.removable){this.eventRemoved=new YAHOO.util.CustomEvent("eventRemoved");var w=document.createElement("img");w.src=lib_path+"images/close.png";w.alt="X";w.title="Delete";w.style.backgroundColor="#EFEFEF";w.style.cssFloat="right";w.style.cursor="pointer";i.appendChild(w);w.onclick=function(){if(confirm("Do you really want to delete it?")){a.destroy();a.eventRemoved.fire(a)}};this.eventRemoved.subscribe(this.onRemove,this,true)}if(this.configurable){var E=document.createElement("img");E.src=lib_path+"images/gear.png";E.alt="*";E.title="Preferences";E.style.cssFloat="right";E.style.marginRight="10px";E.style.cursor="pointer";i.appendChild(E);E.onclick=function(){u.style.display="block"}}n.appendChild(i);if(this.draggable){var S=new YAHOO.util.DD(e+"Outer");S.setHandleElId(e+"Handle");this.eventDragged=new YAHOO.util.CustomEvent("eventDragged");S.on("endDragEvent",function(e){this.eventDragged.fire(this)},this,true);this.eventDragged.subscribe(this.onDrag,this,true);if(t.parentEl){var x=document.getElementById(t.parentEl);var T=n.offsetLeft-x.offsetLeft;var N=x.offsetLeft+x.offsetWidth-n.offsetLeft-n.offsetWidth;var C=n.offsetTop-x.offsetTop;var k=x.offsetTop+x.offsetHeight-n.offsetTop-n.offsetHeight;S.setXConstraint(T,N);S.setYConstraint(C)}else{var T=n.offsetLeft;var C=n.offsetTop;S.setXConstraint(T);S.setYConstraint(C)}}}if(this.resizable){var L=document.createElement("div");L.id="yui-gen0";L.className="yui-resize-handle yui-resize-handle-r";var A=document.createElement("div");A.className="yui-resize-handle-inner-r";L.appendChild(A);n.appendChild(L);var O=new YAHOO.util.Resize(e+"Outer",{handles:["r"],minWidth:10,minHeight:10,maxWidth:1200,maxHeight:800});this.eventResized=new YAHOO.util.CustomEvent("eventResized");O.on("endResize",function(e){this.eventResized.fire(this)},this,true);this.eventResized.subscribe(this.onResize,this,true)}this.container=e;this.interactionList=[];this.parts=[];this.annotations=[];this.parentDocument=null;this.level=Timeline.DateTime.YEAR;if(this.base=="Simile"){this.eventSource=new Timeline.DefaultEventSource;var M=Timeline.ClassicTheme.create();M.event.tape.height=7;M.event.track.offset=15;M.event.track.height=30;var _=[Timeline.createBandInfo({width:"70%",intervalUnit:this.level-1,intervalPixels:100,zoomIndex:10,zoomSteps:new Array({pixelsPerInterval:100,unit:Timeline.DateTime.DAY},{pixelsPerInterval:100,unit:Timeline.DateTime.MONTH},{pixelsPerInterval:100,unit:Timeline.DateTime.YEAR},{pixelsPerInterval:100,unit:Timeline.DateTime.DECADE}),eventSource:this.eventSource,theme:M,layout:"original"}),Timeline.createBandInfo({width:"30%",intervalUnit:this.level,intervalPixels:80,zoomSteps:new Array({pixelsPerInterval:80,unit:Timeline.DateTime.MONTH},{pixelsPerInterval:80,unit:Timeline.DateTime.YEAR},{pixelsPerInterval:80,unit:Timeline.DateTime.DECADE},{pixelsPerInterval:80,unit:Timeline.DateTime.CENTURY}),eventSource:this.eventSource,theme:M,layout:"overview"})];_[1].highlight=true;_[1].syncWith=0;this.tl=Timeline.create(r,_,Timeline.HORIZONTAL)}else if(this.base=="Chap"){if(this.header)var t={width:"auto",height:"auto",minHeight:this.height-20,style:"box"};else var t={width:"auto",height:"auto",minHeight:this.height,style:"box"};this.tl=new links.Timeline(r,t);this.tl.setVisibleChartRange(new Date(2013,1,1),new Date(2016,1,1))}else alert('this type "'+this.base+'" is not supported.')};WIND.Timeline.Interval=["Second","Minute","Hour","Day","Week","Month","Year","Century","Millennium","10Millennia","100 Millennia","Million","10Millions","100Millions","Billion","10Billions"];WIND.Timeline.prototype.destroy=function(){var e=document.getElementById(this.container+"Outer");if(this.parentEl){var t=[];for(var n=0;n<this.parentDocument.viewers.length;n++){if(this.parentDocument.viewers[n].container!=this.container){t.push(this.parentDocument.viewers[n])}}this.parentDocument.viewers=t;document.getElementById(this.parentEl).removeChild(e)}else document.body.removeChild(e)};WIND.Timeline.prototype.onDrag=function(){this.top=document.getElementById(this.container+"Outer").offsetTop;this.left=document.getElementById(this.container+"Outer").offsetLeft};WIND.Timeline.prototype.onResize=function(){this.width=document.getElementById(this.container+"Outer").offsetWidth;this.height=document.getElementById(this.container+"Outer").offsetHeight};WIND.Timeline.prototype.onConfigure=function(){};WIND.Timeline.prototype.onRemove=function(){};WIND.Timeline.prototype.addAnnotation=function(e){var t=false;for(var n=0;n<e.annotedObjects.length;n++){if(e.annotedObjects.type=="timeline"){t=true;break}}this.annotations.push(e)};WIND.Timeline.prototype.createAnnotation=function(e,t,n,r,i){var s=this.createSensiblePart(t,n,r,i);var o=new WIND.Annotation(e,t,new Array(s));this.annotations.push(o);if(this.base=="Chap")this.tl.setVisibleChartRange(new Date(2013,1,1),new Date(2016,1,1));return o};WIND.Timeline.prototype.createSensiblePart=function(e,t,n,r){var i=new WIND.Timeline.Part(e,t,n,this.base);i.viewer=this;this.parts.push(i);if(this.base=="Simile"){this.eventSource.add(i.tlEvent);this.tl.layout()}else if(this.base=="Chap"){var s=[];for(var o=0;o<this.parts.length;o++)s=s.concat(this.parts[o].data);this.tl.setData(s);this.tl.setVisibleChartRangeAuto()}return i};WIND.Timeline.prototype.getValue=function(){return{id:this.container,ref:this.ref,rdftype:"http://erozate.iutbayonne.univ-pau.fr/wind#TimelineComponent",name:this.name,position:{top:this.top,left:this.left},size:{width:this.width,height:this.height},style:{color:this.color,border:this.border,icon:this.icon},annotation:this.annotation,display:this.display,load:this.load,parameter:{draggable:this.draggable?"yes":"no",resizable:this.resizable?"yes":"no",removable:this.removable?"yes":"no",configurable:this.configurable?"yes":"no",header:this.header?"yes":"no",toolbar:"no"}}};WIND.Timeline.prototype.loadRDFFile=function(e,t){var n=createXHR();n.open("GET",e+"?rdf="+t,false);n.send(null);if(n.status==200){var r=YAHOO.lang.JSON.parse(n.responseText);var i=r.annotations;var s=this.eventSource._events.getUnit().getParser("iso8601");for(var o=0;o<i.length;o++){var u=new Timeline.DefaultEventSource.Event({id:"Event "+i[o].entityName,start:s(i[o].temporalInfo[0].tempoStart),end:s(i[o].temporalInfo[0].tempoEnd),instant:i[o].temporalInfo[0].tempoStart==i[o].temporalInfo[0].tempoEnd?true:false,text:i[o].entityName,description:"Description for Event "+i[o].entityName,icon:lib_path+"images/timeicon64.png"});this.eventSource.add(u)}this.tl.layout()}else{document.getElementById(this.container).innerHTML="Error: "+t+" "+n.status+" "+n.statusText}};WIND.Timeline.Part=function(e,t,n,r){this.eventName=e;this.starting=t;this.ending=n;this.type=t==n?"Instant":"Interval";var i=new Timeline.DefaultEventSource;var s=i._events.getUnit().getParser("iso8601");var o=s(t);if(r=="Simile"){this.tlEvent=new Timeline.DefaultEventSource.Event({id:"Event "+e,start:s(t),end:s(n),instant:t==n?true:false,text:e,description:"Description for Event "+e})}else if(r=="Chap"){this.data=[];if(this.type=="Interval")this.data.push({start:new Date(this.starting),end:new Date(this.ending),content:this.eventName});else this.data.push({start:new Date(this.starting),content:this.eventName,type:"dot"})}};WIND.Timeline.Part.prototype.callFunction=function(e){switch(e){case"zoom":this.zoomTo();break;case"focus":this.highlight();this.zoomTo();break}};WIND.Timeline.Part.prototype.zoomTo=function(){if(this.viewer.base=="Simile")this.viewer.tl.getBand(0).setCenterVisibleDate(new Date(this.ending));else if(this.viewer.base=="Chap"){var e=(this.viewer.tl.end.valueOf()-this.viewer.tl.start.valueOf())/2;var t=Date.parse(this.ending);this.viewer.tl.setVisibleChartRange(new Date(t-e),new Date(t+e))}};WIND.Timeline.Part.prototype.highlight=function(){if(this.viewer.base=="Simile"){if(this.type=="Instant"){this.tlEvent._color="#00aa00";this.tlEvent._icon=lib_path+"images/green-circle.png"}else if(this.type=="Interval")this.tlEvent._color="#00aa00";this.viewer.tl.layout()}else if(this.viewer.base=="Chap"){this.data[0].className="timeline-event-highlight";this.viewer.tl.redraw()}}